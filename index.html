<!DOCTYPE html>
<html lang="en">
<head>
    <script> 
        // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyANdNxLF8GKvtxdCxogs30_8_3pg9P7x5Q",
  authDomain: "attendance-calendar-ae106.firebaseapp.com",
  projectId: "attendance-calendar-ae106",
  storageBucket: "attendance-calendar-ae106.firebasestorage.app",
  messagingSenderId: "963030500166",
  appId: "1:963030500166:web:70783b84a1cb4cde221b47",
  measurementId: "G-HZHJBWHB25"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
    </script>
    
  <meta charset="UTF-8" />
  <title>Night Shift Attendance Calendar with Cloud Login</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; max-width: 950px; }
    /* ... all your existing styles ... */
    /* (copy from your previous calendar's CSS) */
    /* Calendar/table/button styles omitted for brevity (use your latest version) */
  </style>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- LOGIN PANEL -->
  <div id="loginPanel" style="margin-bottom:25px;">
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="signup()">Sign up</button>
    <span id="userInfo" style="margin-left:12px;"></span>
    <button onclick="logout()" id="logoutBtn" style="margin-left:12px; display:none;">Logout</button>
  </div>

  <!-- CALENDAR CONTROLS -->
  <h1>Night Shift Attendance Calendar</h1>
  <label>
    Select First Office Night:
    <input type="date" id="startDate" value="2025-08-15" />
  </label>
  <button onclick="init()">Initialize</button>

  <div id="navButtons" style="margin-top:20px;">
    <button onclick="prevMonth()">← Previous Month</button>
    <button onclick="nextMonth()">Next Month →</button>
    <button onclick="exportCalendarPDF()">Export Current Month as PDF</button>
  </div>
  <button id="multiSelectBtn" onclick="toggleMultiSelect()">Enable Multi-select Mode</button>

  <div id="sidePanel">
    <div id="calendarContainer" class="calendar"></div>
    <div id="statsPanel">
      <!-- ... stats divs per your previous code ... -->
    </div>
    <div id="editPanel" style="display:none;">
      <!-- ... single date edit controls ... -->
    </div>
    <div id="batchEditPanel">
      <!-- ... multi-select edit controls ... -->
    </div>
  </div>

  <script>
    // ---- FIREBASE CONFIG ----
    // Replace with your Firebase config below!
    const firebaseConfig = {
      apiKey: "YOUR-API-KEY",
      authDomain: "YOUR-PROJECT-ID.firebaseapp.com",
      projectId: "YOUR-PROJECT-ID",
      // ... etc ...
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ---- USER LOGIN ----
    let userId = null;
    let userEmail = "";

    function login() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(user => {
          userId = user.user.uid;
          userEmail = email;
          document.getElementById("loginPanel").style.display = "none";
          document.getElementById("logoutBtn").style.display = "inline-block";
          document.getElementById("userInfo").innerText = "Logged in as " + email;
          loadCloudData();
        })
        .catch(err => alert(err.message));
    }

    function signup() {
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(user => {
          alert("Signup successful! Please login.");
        })
        .catch(err => alert(err.message));
    }

    function logout() {
      auth.signOut().then(() => {
        userId = null;
        userEmail = "";
        document.getElementById("loginPanel").style.display = "block";
        document.getElementById("logoutBtn").style.display = "none";
        document.getElementById("userInfo").innerText = "";
        location.reload();
      });
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        userId = user.uid;
        userEmail = user.email;
        document.getElementById("loginPanel").style.display = "none";
        document.getElementById("userInfo").innerText = "Logged in as " + user.email;
        document.getElementById("logoutBtn").style.display = "inline-block";
        loadCloudData();
      } else {
        userId = null;
        userEmail = "";
        document.getElementById("loginPanel").style.display = "block";
        document.getElementById("logoutBtn").style.display = "none";
        document.getElementById("userInfo").innerText = "";
      }
    });

    // ---- CALENDAR LOGIC ----
    // (Paste your latest calendar JS code here, with these two functions replaced)

    function saveAttendanceData(year, month) {
      if (!userId) return;
      const docKey = `${year}_${month}`;
      db.collection("attendance").doc(userId).set({
        [docKey]: attendanceMap
      }, { merge: true });
    }

    function loadCloudData() {
      if (!userId) return;
      const docKey = `${currentYear}_${currentMonth}`;
      db.collection("attendance").doc(userId).get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();
          attendanceMap = data[docKey] ? data[docKey] : {};
          if (Object.keys(attendanceMap).length === 0) initializeMonthData(currentYear, currentMonth);
        } else {
          initializeMonthData(currentYear, currentMonth);
        }
        drawCalendar(currentYear, currentMonth);
        updateStats();
        resetEditPanel();
      });
    }

    // Paste all your previous JS code for drawing calendar, stats, multi-select, single-edit, PDF export, etc.

    // The only change from your latest version is: cloud data replaces localStorage, and calendar loading/saving works per user login.

  </script>
</body>
</html>
